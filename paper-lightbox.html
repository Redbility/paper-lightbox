
<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../iron-icons/iron-icons.html"/>
<link rel="import" href="../iron-ajax/iron-ajax.html"/>
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"/>
<dom-module id="paper-lightbox">
  <template>
    <style>:host{display:block}:host::content .paper-lightbox-popup{position:fixed;top:0;right:0;bottom:0;left:0;z-index:999;overflow:auto;text-align:center}:host::content .paper-lightbox-popup::before{content:'';display:inline-block;vertical-align:middle;width:0;height:100%}:host::content .paper-lightbox-popup_overlay{position:fixed;background-color:#000;width:100%;height:100%;top:0;left:0;opacity:.6;z-index:0}:host::content .paper-lightbox-popup_window{position:relative;display:inline-block;vertical-align:middle;padding:25px;margin:40px 0 20px;background-color:#fff;max-width:70%;height:auto;text-align:left;box-sizing:border-box;z-index:1}@media (max-width:568px){:host::content .paper-lightbox-popup_window{max-width:100%;margin:25px;padding:15px}}:host::content .paper-lightbox-popup_window .paper-lightbox_iframeWrapper{position:relative;padding-top:60%}:host::content .paper-lightbox-popup_window-image img{vertical-align:top;max-width:100%}:host::content .paper-lightbox-popup_window-iframe{width:70%;height:auto;max-width:1024px}@media (max-width:568px){:host::content .paper-lightbox-popup_window-iframe{width:calc(100% - 50px);margin:25px}}:host::content .paper-lightbox-popup_window-iframe iframe{position:absolute;width:100%;height:100%;top:0;left:0}:host::content .paper-lightbox-popup_close{position:absolute;left:0;top:0;width:18px;height:18px;padding:8px;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:#fff;border-radius:100px;cursor:pointer;-webkit-filter:drop-shadow(0 1px 2px rgba(0, 0, 0, .4));filter:drop-shadow(0 1px 2px rgba(0, 0, 0, .4))}</style>
    <template is="dom-if" if="{{ _isAjax() }}">
      <iron-ajax auto="auto" url="{{ src }}" handle-as="text" on-response="_ajaxResponse"></iron-ajax>
    </template>
    <button>
      <content></content>
    </button>
  </template>
  <script>(function(){Polymer({is:"paper-lightbox",behaviors:[Polymer.IronResizableBehavior],listeners:{"iron-resize":"_onResize"},_createPopup:function(){var e,t,n,i,o,r,s,a,c;for(s=this,a=null!==s.getAttribute("closingTime")&&void 0!==s.getAttribute("openingTime")?s.getAttribute("openingTime"):0,i=document.createElement("div"),i.classList.add("paper-lightbox-popup"),i.classList.add("opening"),setTimeout(function(){return i.classList.remove("opening")},a),n=document.createElement("iron-icon"),n.classList.add("paper-lightbox-popup_close"),n.setAttribute("icon","icons:close"),s.window=document.createElement("div"),s.window.classList.add("paper-lightbox-popup_window"),s.window.appendChild(n),i.appendChild(s.window),c=document.createElement("div"),c.classList.add("paper-lightbox-popup_overlay"),i.appendChild(c),s.appendChild(i),o=document.documentElement,o.classList.add("lock"),r=document.createElement("div"),r.classList.add("paper-lightbox-lockScroll"),e=document.body.children,t=e.length,r.style.height="100%",o.style.height="100%",document.body.style.height="100%",r.style.overflow="hidden";document.body.firstChild;)r.appendChild(document.body.firstChild);return document.body.appendChild(r)},_getImageRatio:function(e,t){var n;return n=this,e>t?n.window.classList.add("landscape"):n.window.classList.add("portrait")},_isAjax:function(){var e;if(e=this,"ajax"===this._getType())return!0},_parseAjax:function(e){var t,n;return n=this,t=document.createElement("div"),t.innerHTML=e,[].forEach.call(t.children,function(e,t){return n.window.appendChild(e)})},_ajaxResponse:function(e){var t;return t=this,t.ajaxResponse=e.target.lastResponse},_createAjax:function(){var e;return e=this,this._fireCustomEvents("onBeforeOpen"),this._createPopup(),this._parseAjax(e.ajaxResponse),e.window.classList.add("paper-lightbox-popup_window-ajax"),this._fireCustomEvents("onAfterOpen"),this._closePopup()},_createImage:function(){var e,t;return t=this,e=new Image,this._fireCustomEvents("onBeforeOpen"),e.onload=function(){return t._createPopup(),t._getImageRatio(e.naturalWidth,e.naturalHeight),t.window.classList.add("paper-lightbox-popup_window-image"),t.window.appendChild(e),t._onResize(),t._fireCustomEvents("onAfterOpen"),t._closePopup()},e.src=t.getAttribute("src")},_createIframe:function(){var e,t,n,i,o;return n=this,o=n.getAttribute("src"),e=document.createElement("iframe"),i=o.replace("/watch?v=","/embed/"),e.setAttribute("frameborder","0"),e.setAttribute("allowfullscreen",""),this._fireCustomEvents("onBeforeOpen"),t=document.createElement("div"),t.classList.add("paper-lightbox_iframeWrapper"),o.indexOf("youtube.com/watch?v=")>-1?e.setAttribute("src",i+"?autoplay=1"):e.setAttribute("src",o+"?autoplay=1"),this._createPopup(),n.window.classList.add("paper-lightbox-popup_window-iframe"),setTimeout(function(){return t.appendChild(e),n.window.appendChild(t)},100),this._fireCustomEvents("onAfterOpen"),this._closePopup()},_createInline:function(){var e,t;return t=this,e=document.querySelector(t.getAttribute("src")),this._fireCustomEvents("onBeforeOpen"),this._createPopup(),t.window.classList.add("paper-lightbox-popup_window-inline"),t.window.appendChild(e.cloneNode(!0)),this._fireCustomEvents("onAfterOpen"),this._closePopup()},_getType:function(){var e;return e=this,e.getAttribute("type")},_launchPopup:function(){var e;switch(e=this,this._getType()){case"ajax":return e.listen(e.$$("button"),"tap","_createAjax");case"image":return e.listen(e.$$("button"),"tap","_createImage");case"inline":return e.listen(e.$$("button"),"tap","_createInline");case"iframe":return e.listen(e.$$("button"),"tap","_createIframe")}},_removePopup:function(){var e,t,n,i,o,r;for(o=this,r=o.querySelector(".paper-lightbox-popup"),this.window=void 0,e=null!==o.getAttribute("closingTime")&&void 0!==o.getAttribute("closingTime")?o.getAttribute("closingTime"):0,this._fireCustomEvents("onBeforeClose"),r.classList.add("closing"),setTimeout(function(){return o.removeChild(r),o._fireCustomEvents("onAfterClose")},e),document.body.style.overflow="",t=document.documentElement,t.classList.remove("lock"),n=document.querySelector(".paper-lightbox-lockScroll"),i=n.children,n.style.height="",t.style.height="",document.body.style.height="",n.style.overflow="";n.firstChild;)document.body.appendChild(n.firstChild);return document.body.removeChild(n)},_closePopup:function(){var e,t,n;return t=this,n=t.querySelector(".paper-lightbox-popup_overlay"),e=t.querySelector(".paper-lightbox-popup_close"),t.listen(n,"tap","_removePopup"),t.listen(e,"tap","_removePopup")},_onResize:function(){var e;if(this.window&&this.window.classList.contains("portrait"))return e=this.window.querySelector("img"),e.style.maxHeight=.8*window.innerHeight+"px"},ready:function(){var e;return e=this,this.async(function(){return setTimeout(function(){return e._onLoad(),e._defineCustomEvents()},0)})},_onLoad:function(){return this._launchPopup()},_defineCustomEvents:function(){var e,t,n;return n=this,e=["onBeforeOpen","onAfterOpen","onBeforeClose","onAfterClose"],t=e.length,[].forEach.call(e,function(e){return n[e]=void 0,document.createEvent?(n[e]=document.createEvent("HTMLEvents"),n[e].initEvent(e.toLowerCase(),!0,!0)):(n.e=document.createEventObject(),n.e.eventType=e.toLowerCase()),n[e].eventName=e.toLowerCase()})},_fireCustomEvents:function(e){var t;return t=this,document.createEvent?t.dispatchEvent(t[e]):t.fireEvent("on"+t[e].eventType,t[e])},open:function(){var e;switch(e=this,this._getType()){case"ajax":return this._createAjax();case"image":return this._createImage();case"inline":return this._createInline();case"iframe":return this._createIframe()}}})}).call(this);</script>
</dom-module>